{"version":3,"file":"index.modern.js","sources":["../index.js"],"sourcesContent":["const KEYCODE = {\r\n  LEFT: 37,\r\n  UP: 38,\r\n  RIGHT: 39,\r\n  DOWN: 40,\r\n}\r\n\r\nconst state = new Map()\r\n// when container or children get focus\r\nconst onFocusin = e => {\r\n  const {target: rover} = e\r\n  if (state.get('last_rover') == rover) return\r\n  if (state.has(rover)) {\r\n    activate(rover, state.get(rover).active)\r\n    state.set('last_rover', rover)\r\n  }\r\n}\r\nconst onKeydown = e => {\r\n  const {target: rover} = e\r\n  switch (e.keyCode) {\r\n    case KEYCODE[isRtl ? 'LEFT' : 'RIGHT']:\r\n    case KEYCODE.DOWN:\r\n      e.preventDefault()\r\n      focusNextItem(rover)\r\n      break\r\n    case KEYCODE[isRtl ? 'RIGHT' : 'LEFT']:\r\n    case KEYCODE.UP:\r\n      e.preventDefault()\r\n      focusPreviousItem(rover)\r\n      break\r\n  }\r\n}\r\nconst mo = new MutationObserver((mutationList, observer) =>{\r\n  mutationList.forEach(mutation => {\r\n     if(mutation.removedNodes.length > 0){\r\n       mutation.removedNodes.forEach(e => {\r\n         if (state.has(e)) {\r\n           const currentEl = state.get(e);\r\n           e.removeEventListener('focusin', onFocusin)\r\n           e.removeEventListener('keydown', onKeydown)\r\n           state.delete(e)\r\n           currentEl.targets.forEach(a => a.tabIndex = '') \r\n           const keys = [...state.keys()]?.filter(x => x!=='last_rover')           \r\n           if (keys.length === 0) {\r\n             state.clear();\r\n            // console.log('stop observing');\r\n             mo.disconnect()\r\n           }\r\n          }\r\n        })\r\n      }\r\n   })\r\n })         \r\n\r\nexport const rovingIndex = ({element:rover, target:selector}) => {\r\n  const isRtl = window.getComputedStyle(document.documentElement).direction === 'rtl';\r\n  // this api allows empty or a query string\r\n  const target_query = selector || ':scope *'\r\n  const targets = rover.querySelectorAll(target_query)\r\n  const startingPoint = targets[0]\r\n\r\n  // take container out of the focus flow\r\n  rover.tabIndex = -1\r\n  // and all the children\r\n  targets.forEach(a => a.tabIndex = -1)\r\n  // except the first target, that accepts focus\r\n  startingPoint.tabIndex = 0\r\n\r\n  // with the roving container as the key\r\n  // save some state and handy references\r\n  state.set(rover, {\r\n    targets,\r\n    active: startingPoint,\r\n    index: 0,\r\n  })\r\n\r\n  // when container or children get focus\r\n  // const onFocusin = _ => {\r\n  //   if (state.get('last_rover') == rover) return\r\n\r\n  //   activate(rover, state.get(rover).active)\r\n  //   state.set('last_rover', rover)\r\n  // }\r\n  rover.addEventListener('focusin', onFocusin)\r\n\r\n  // watch for arrow keys\r\n  \r\n  rover.addEventListener('keydown', onKeydown)\r\n\r\n  //  replace rover.addEventListener('DOMNodeRemovedFromDocument', cleanup)\r\n  // with mutationObserver\r\n  mo.observe(document, {\r\n    childList: true,\r\n    subtree: true\r\n  }) \r\n}\r\n\r\nconst focusNextItem = rover => {\r\n  const rx = state.get(rover)\r\n\r\n  // increment state index\r\n  rx.index += 1\r\n\r\n  // clamp navigation to target bounds\r\n  if (rx.index > rx.targets.length - 1)\r\n    rx.index = rx.targets.length - 1\r\n\r\n  // use rover index state to find next\r\n  let next = rx.targets[rx.index]\r\n\r\n  // found something, activate it\r\n  next && activate(rover, next)\r\n}\r\n\r\nconst focusPreviousItem = rover => {\r\n  const rx = state.get(rover)\r\n\r\n  // decrement from the state index\r\n  rx.index -= 1\r\n\r\n  // clamp to 0 and above only\r\n  if (rx.index < 1)\r\n    rx.index = 0\r\n\r\n  // use rover index state to find next\r\n  let prev = rx.targets[rx.index]\r\n\r\n  // found something, activate it\r\n  prev && activate(rover, prev)\r\n}\r\n\r\nconst activate = (rover, item) => {\r\n  const rx = state.get(rover)\r\n\r\n  // remove old tab index item\r\n  rx.active.tabIndex = -1\r\n\r\n  // set new active item and focus it\r\n  rx.active = item\r\n  rx.active.tabIndex = 0\r\n  rx.active.focus()\r\n}\r\n"],"names":["KEYCODE","LEFT","UP","RIGHT","DOWN","state","Map","onFocusin","e","target","rover","get","has","activate","active","set","onKeydown","keyCode","isRtl","preventDefault","focusNextItem","focusPreviousItem","mo","MutationObserver","mutationList","observer","forEach","mutation","removedNodes","length","currentEl","removeEventListener","delete","targets","a","tabIndex","keys","_ref","filter","x","clear","disconnect","rovingIndex","element","selector","window","getComputedStyle","document","documentElement","querySelectorAll","startingPoint","index","addEventListener","observe","childList","subtree","rx","next","prev","item","focus"],"mappings":"AAAA,MAAMA,EAAU,CACdC,KAAM,GACNC,GAAI,GACJC,MAAO,GACPC,KAAM,IAGFC,EAAQ,IAAIC,IAEZC,EAAYC,IAChB,MAAOC,OAAQC,GAASF,EACpBH,EAAMM,IAAI,eAAiBD,GAC3BL,EAAMO,IAAIF,KACZG,EAASH,EAAOL,EAAMM,IAAID,GAAOI,QACjCT,EAAMU,IAAI,aAAcL,KAGtBM,EAAYR,IAChB,MAAOC,OAAQC,GAASF,EACxB,OAAQA,EAAES,SACR,KAAKjB,EAAQkB,MAAQ,OAAS,SAC9B,KAAKlB,EAAQI,KACXI,EAAEW,iBACFC,EAAcV,GACd,MACF,KAAKV,EAAQkB,MAAQ,QAAU,QAC/B,KAAKlB,EAAQE,GACXM,EAAEW,iBACFE,EAAkBX,KAIlBY,EAAK,IAAIC,iBAAiB,CAACC,EAAcC,KAC7CD,EAAaE,QAAQC,IACfA,EAASC,aAAaC,OAAS,GAChCF,EAASC,aAAaF,QAAQlB,IAC5B,GAAIH,EAAMO,IAAIJ,GAAI,OAChB,MAAMsB,EAAYzB,EAAMM,IAAIH,GAC5BA,EAAEuB,oBAAoB,UAAWxB,GACjCC,EAAEuB,oBAAoB,UAAWf,GACjCX,EAAM2B,OAAOxB,GACbsB,EAAUG,QAAQP,QAAQQ,GAAKA,EAAEC,SAAW,IAExB,cADP,IAAI9B,EAAM+B,gBAAVC,EAAmBC,OAAOC,GAAS,eAAJA,IACnCV,SACPxB,EAAMmC,QAENlB,EAAGmB,qBAQHC,EAAc,EAAEC,QAAQjC,EAAOD,OAAOmC,MACnCC,OAAOC,iBAAiBC,SAASC,iBAE/C,MACMf,EAAUvB,EAAMuC,iBADDL,GAAY,YAE3BM,EAAgBjB,EAAQ,GAG9BvB,EAAMyB,UAAY,EAElBF,EAAQP,QAAQQ,GAAKA,EAAEC,UAAY,GAEnCe,EAAcf,SAAW,EAIzB9B,EAAMU,IAAIL,EAAO,CACfuB,QAAAA,EACAnB,OAAQoC,EACRC,MAAO,IAUTzC,EAAM0C,iBAAiB,UAAW7C,GAIlCG,EAAM0C,iBAAiB,UAAWpC,GAIlCM,EAAG+B,QAAQN,SAAU,CACnBO,WAAW,EACXC,SAAS,KAIPnC,EAAgBV,IACpB,MAAM8C,EAAKnD,EAAMM,IAAID,GAGrB8C,EAAGL,OAAS,EAGRK,EAAGL,MAAQK,EAAGvB,QAAQJ,OAAS,IACjC2B,EAAGL,MAAQK,EAAGvB,QAAQJ,OAAS,GAGjC,IAAI4B,EAAOD,EAAGvB,QAAQuB,EAAGL,OAGzBM,GAAQ5C,EAASH,EAAO+C,IAGpBpC,EAAoBX,IACxB,MAAM8C,EAAKnD,EAAMM,IAAID,GAGrB8C,EAAGL,OAAS,EAGRK,EAAGL,MAAQ,IACbK,EAAGL,MAAQ,GAGb,IAAIO,EAAOF,EAAGvB,QAAQuB,EAAGL,OAGzBO,GAAQ7C,EAASH,EAAOgD,IAGpB7C,EAAW,CAACH,EAAOiD,KACvB,MAAMH,EAAKnD,EAAMM,IAAID,GAGrB8C,EAAG1C,OAAOqB,UAAY,EAGtBqB,EAAG1C,OAAS6C,EACZH,EAAG1C,OAAOqB,SAAW,EACrBqB,EAAG1C,OAAO8C"}