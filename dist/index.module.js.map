{"version":3,"file":"index.module.js","sources":["../index.js"],"sourcesContent":["const KEYCODE = {\n  LEFT: 37,\n  UP: 38,\n  RIGHT: 39,\n  DOWN: 40,\n}\n\nconst state = new Map()\n\nexport const rovingIndex = ({element:rover, target:selector}) => {\n  const isRtl = window.getComputedStyle(document.documentElement).direction === 'rtl';\n  // this api allows empty or a query string\n  const target_query = selector || ':scope *'\n  const targets = rover.querySelectorAll(target_query)\n  const startingPoint = targets[0]\n\n  // take container out of the focus flow\n  rover.tabIndex = -1\n  // and all the children\n  targets.forEach(a => a.tabIndex = -1)\n  // except the first target, that accepts focus\n  startingPoint.tabIndex = 0\n\n  // with the roving container as the key\n  // save some state and handy references\n  state.set(rover, {\n    targets,\n    active: startingPoint,\n    index: 0,\n  })\n\n  // when container or children get focus\n  const onFocusin = _ => {\n    if (state.get('last_rover') == rover) return\n\n    activate(rover, state.get(rover).active)\n    state.set('last_rover', rover)\n  }\n  rover.addEventListener('focusin', onFocusin)\n\n  // watch for arrow keys\n  const onKeydown = e => {\n    switch (e.keyCode) {\n      case KEYCODE[isRtl ? 'LEFT' : 'RIGHT']:\n      case KEYCODE.DOWN:\n        e.preventDefault()\n        focusNextItem(rover)\n        break\n      case KEYCODE[isRtl ? 'RIGHT' : 'LEFT']:\n      case KEYCODE.UP:\n        e.preventDefault()\n        focusPreviousItem(rover)\n        break\n    }\n  }\n  rover.addEventListener('keydown', onKeydown)\n\n  const cleanup = _ => {\n    rover.removeEventListener('focusin', onFocusin)\n    rover.removeEventListener('keydown', onKeydown)\n    rover.removeEventListener('DOMNodeRemoved', cleanup)\n\n    state.delete(rover)\n    targets.forEach(a => a.tabIndex = '')\n  }\n\n  rover.addEventListener('DOMNodeRemovedFromDocument', cleanup)\n}\n\nconst focusNextItem = rover => {\n  const rx = state.get(rover)\n\n  // increment state index\n  rx.index += 1\n\n  // clamp navigation to target bounds\n  if (rx.index > rx.targets.length - 1)\n    rx.index = rx.targets.length - 1\n\n  // use rover index state to find next\n  let next = rx.targets[rx.index]\n\n  // found something, activate it\n  next && activate(rover, next)\n}\n\nconst focusPreviousItem = rover => {\n  const rx = state.get(rover)\n\n  // decrement from the state index\n  rx.index -= 1\n\n  // clamp to 0 and above only\n  if (rx.index < 1)\n    rx.index = 0\n\n  // use rover index state to find next\n  let prev = rx.targets[rx.index]\n\n  // found something, activate it\n  prev && activate(rover, prev)\n}\n\nconst activate = (rover, item) => {\n  const rx = state.get(rover)\n\n  // remove old tab index item\n  rx.active.tabIndex = -1\n\n  // set new active item and focus it\n  rx.active = item\n  rx.active.tabIndex = 0\n  rx.active.focus()\n}\n"],"names":["KEYCODE","LEFT","UP","RIGHT","DOWN","state","Map","rovingIndex","rover","element","selector","target","isRtl","window","getComputedStyle","document","documentElement","direction","targets","querySelectorAll","startingPoint","tabIndex","forEach","a","set","active","index","onFocusin","_","get","activate","addEventListener","onKeydown","e","keyCode","preventDefault","focusNextItem","focusPreviousItem","cleanup","removeEventListener","rx","length","next","prev","item","focus"],"mappings":"AAAA,IAAMA,EAAU,CACdC,KAAM,GACNC,GAAI,GACJC,MAAO,GACPC,KAAM,IAGFC,EAAQ,IAAIC,IAELC,EAAc,gBAAUC,IAARC,QAAsBC,IAAPC,OACpCC,EAAwE,QAAhEC,OAAOC,iBAAiBC,SAASC,iBAAiBC,UAG1DC,EAAUV,EAAMW,iBADDT,GAAY,YAE3BU,EAAgBF,EAAQ,GAG9BV,EAAMa,UAAY,EAElBH,EAAQI,QAAQ,SAAAC,UAAKA,EAAEF,UAAY,IAEnCD,EAAcC,SAAW,EAIzBhB,EAAMmB,IAAIhB,EAAO,CACfU,QAAAA,EACAO,OAAQL,EACRM,MAAO,IAIT,IAAMC,EAAY,SAAAC,GACZvB,EAAMwB,IAAI,eAAiBrB,IAE/BsB,EAAStB,EAAOH,EAAMwB,IAAIrB,GAAOiB,QACjCpB,EAAMmB,IAAI,aAAchB,KAE1BA,EAAMuB,iBAAiB,UAAWJ,GAGlC,IAAMK,EAAY,SAAAC,GAChB,OAAQA,EAAEC,SACR,KAAKlC,EAAQY,EAAQ,OAAS,SAC9B,KAAKZ,EAAQI,KACX6B,EAAEE,iBACFC,EAAc5B,GACd,MACF,KAAKR,EAAQY,EAAQ,QAAU,QAC/B,KAAKZ,EAAQE,GACX+B,EAAEE,iBACFE,EAAkB7B,KAIxBA,EAAMuB,iBAAiB,UAAWC,GAWlCxB,EAAMuB,iBAAiB,6BATP,SAAVO,EAAUV,GACdpB,EAAM+B,oBAAoB,UAAWZ,GACrCnB,EAAM+B,oBAAoB,UAAWP,GACrCxB,EAAM+B,oBAAoB,iBAAkBD,GAE5CjC,SAAaG,GACbU,EAAQI,QAAQ,SAAAC,UAAKA,EAAEF,SAAW,QAMhCe,EAAgB,SAAA5B,GACpB,IAAMgC,EAAKnC,EAAMwB,IAAIrB,GAGrBgC,EAAGd,OAAS,EAGRc,EAAGd,MAAQc,EAAGtB,QAAQuB,OAAS,IACjCD,EAAGd,MAAQc,EAAGtB,QAAQuB,OAAS,GAGjC,IAAIC,EAAOF,EAAGtB,QAAQsB,EAAGd,OAGzBgB,GAAQZ,EAAStB,EAAOkC,IAGpBL,EAAoB,SAAA7B,GACxB,IAAMgC,EAAKnC,EAAMwB,IAAIrB,GAGrBgC,EAAGd,OAAS,EAGRc,EAAGd,MAAQ,IACbc,EAAGd,MAAQ,GAGb,IAAIiB,EAAOH,EAAGtB,QAAQsB,EAAGd,OAGzBiB,GAAQb,EAAStB,EAAOmC,IAGpBb,EAAW,SAACtB,EAAOoC,GACvB,IAAMJ,EAAKnC,EAAMwB,IAAIrB,GAGrBgC,EAAGf,OAAOJ,UAAY,EAGtBmB,EAAGf,OAASmB,EACZJ,EAAGf,OAAOJ,SAAW,EACrBmB,EAAGf,OAAOoB"}